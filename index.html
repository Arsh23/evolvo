<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Amatica+SC|Bungee+Hairline|Josefin+Sans|Maven+Pro|Poiret+One|Raleway|Space+Mono|Titillium+Web" rel="stylesheet">
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <!-- d3.js -->
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3-ease.v1.min.js"></script>
    <!-- custom css -->
    <link rel=stylesheet type=text/css href="css/main.css">

</head>

<style>
    .graph {
        width: 100%;
        height: 250px;
    }

    .arc text {
        font: 10px sans-serif;
        text-anchor: middle;
    }

    .arc path {
        /*stroke: #fff;*/
    }
</style>

<body>
    <div class='graph'></div>
    <script>
        var data = [{
            label: 'Brands',
            count: 20,
            value: 108,
            color: '#FF6961'
        }, {
            label: 'Years',
            count: 10,
            value: 22,
            color: '#BA68C8'
        }, {
            label: 'Phones',
            count: 70,
            value: 8704,
            color: '#9FA8DA'
        }];


        //size and margin
        var basewidth = $('.graph').width()
        var baseheight = $('.graph').height()
        var margin = {
                top: 30,
                right: 10,
                bottom: 40,
                left: 10
            },
            width = basewidth - margin.left - margin.right,
            height = baseheight - margin.top - margin.bottom;
        var radius = Math.min(width, height) / 2;
        var donutwidth = 12;
        var anim_delay = 4000; //secs
        var start_angle = 0;
        var end_angle = 0;

        // main canvas
        var svg = d3.select('.graph')
            .append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        var canvas = svg.append("g")
            .attr('transform', 'translate(' + (width / 2) + ',' + (height / 2) + ')');

        var arc = d3.svg.arc()
            .innerRadius(radius - donutwidth)
            .outerRadius(radius)
            .startAngle(function(d) {
                return d.startAngle + start_angle;
            })
            .endAngle(function(d) {
                return d.endAngle + end_angle;
            });

        var pie = d3.layout.pie()
            .value(function(d) {
                return d.count;
            })
            .padAngle(.08)
            .sort(null);

        var ease = d3.easeCircleInOut

        var arc_slice = canvas.selectAll(".arc")
            .data(pie(data))
            .enter()
            .append("g")
            .attr("class", "arc");

        arc_slice.append('path')
            .attr('fill', function(d, i) {
                return d.data.color;
            })
            .transition()
            .duration(anim_delay)
            .attrTween("d", tweenPie);

        function tweenPie(b) {
            var i = d3.interpolate({
                startAngle: start_angle,
                endAngle: end_angle
            }, b);
            return function(t) {
                return arc(i((ease(t))));
            };
        }

        arc_slice.append('circle')
            .attr('fill', 'black')
            // .attr('cx',-10)
            // .attr('cy',-10)
            .attr('r', 2.5)
            .transition()
            .duration(anim_delay)
            .attrTween("transform", tweenDot);

        function tweenDot(b) {
            var i = d3.interpolate({
                startAngle: start_angle,
                endAngle: end_angle
            }, b);
            return function(t) {
                return "translate(" + arc.centroid(i(ease(t))) + ")";
            };
        }

        txt1 = canvas.append('text')
            .text(0)
            .transition()
            .duration(anim_delay)
            .tween("text", tweenText);

        function tweenText(d) {
            var i = d3.interpolate(this.textContent, 8704)

            return function(t) {
                this.textContent = Math.round(i(ease(t)));
            };
        }
    </script>


    <div class='heading'>
        <p class='heading-text'>The evolution of mobiles</p>
    </div>

    <div class='subtext'>
        <p class='subtext-text'>A data visualization experiment to analyze and explore the evolution of mobile phones
            <br> through the years. Data from gsmarena.com</p>
    </div>


</body>

</html>
